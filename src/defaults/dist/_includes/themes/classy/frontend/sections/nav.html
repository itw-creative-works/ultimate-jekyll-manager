<div class="navbar-wrapper">
  <nav class="navbar navbar-expand-lg navbar-floating">
    <!-- Logo -->
    {% capture logo_href %}{% assign temp_href = data.logo.href | default: site.brand.href | default: '/' %}{% if temp_href and temp_href != '' and temp_href != 'null' %}{{ temp_href }}{% else %}javascript:void(0){% endif %}{% endcapture %}
    {% capture logo_src %}{% if data.logo.src %}{{ data.logo.src }}{% else %}{{ site.brand.images.brandmark | default: null }}{% endif %}{% endcapture %}
    {% capture logo_text %}{{ data.logo.text | default: site.brand.name | liquify }}{% endcapture %}
    {% capture logo_class %}{{ data.logo.class }}{% endcapture %}

    <a class="navbar-brand d-inline-flex align-items-center" href="{{ logo_href }}">
      {% iftruthy logo_src %}
        <div class="avatar avatar-md me-2 {{ logo_class }}">
          <img src="{{ logo_src }}" alt="{{ logo_text }} Logo"/>
        </div>
      {% endiftruthy %}
      {% iftruthy logo_text %}
        <span class="text-body">{{ logo_text }}</span>
      {% endiftruthy %}
    </a>

    <!-- Mobile controls wrapper -->
    <div class="d-lg-none d-flex align-items-center ms-auto">
      <!-- Mobile toggle -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Mobile account dropdown (directly to the right of toggler) -->
      {% for action in data.actions %}
        {% if action.type == 'account' and action.dropdown %}
          {% capture action_attributes %}{% if action.attributes %}{% for attr in action.attributes %} {{ attr[0] }}="{{ attr[1] }}"{% endfor %}{% endif %}{% endcapture %}
          <div class="dropdown animation-slide-up ms-2 d-inline-flex" data-wm-bind="@show auth.user" hidden>
            <button class="p-0 border-0 bg-transparent" type="button" data-bs-toggle="dropdown" {{ action_attributes }} aria-expanded="false">
              <span class="d-flex align-items-center">
                <span class="position-relative d-inline-block">
                  <span class="avatar avatar-sm rounded-circle bg-secondary bg-opacity-10 border d-flex align-items-center justify-content-center overflow-hidden d-inline-flex">
                    <img src="{{ site.uj.placeholder.src }}" data-wm-bind="@attr src auth.user.photoURL" alt="{{ site.brand.name }} profile picture"/>
                  </span>
                  <!-- Active status indicator -->
                  <span class="position-absolute bottom-0 end-0 p-1 bg-success border border-2 border-white avatar avatar-2xs rounded-circle mb-1">
                    <span class="visually-hidden">Active status</span>
                  </span>
                </span>
              </span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end shadow" style="min-width: 280px;">
              <!-- User info header (clickable) -->
              <li>
                <a href="/account#profile" class="dropdown-item px-3 py-2 text-decoration-none">
                  <div class="d-flex align-items-center">
                    <div class="position-relative me-3">
                      <div class="avatar avatar-md rounded-circle bg-secondary bg-opacity-10 border d-flex align-items-center justify-content-center overflow-hidden">
                        <img src="{{ site.uj.placeholder.src }}" data-wm-bind="@attr src auth.user.photoURL" alt="{{ site.brand.name }} profile picture"/>
                      </div>
                      <!-- Active status indicator -->
                      <span class="position-absolute bottom-0 end-0 p-1 bg-success border border-2 border-white avatar avatar-2xs rounded-circle mb-0">
                        <span class="visually-hidden">Active status</span>
                      </span>
                    </div>
                    <div class="flex-grow-1 overflow-hidden">
                      <div class="fw-semibold text-truncate text-body" data-wm-bind="@text auth.user.displayName">User</div>
                      <div class="small text-muted text-truncate" data-wm-bind="@text auth.user.email">email@example.com</div>
                    </div>
                  </div>
                </a>
              </li>

              <!-- Dropdown items -->
              {% for child in action.dropdown %}
                {% capture child_attributes %}{% if child.attributes %}{% for attr in child.attributes %} {{ attr[0] }}="{{ attr[1] }}"{% endfor %}{% endif %}{% endcapture %}
                {% capture child_active %}{% urlmatches child.href, "active" %}{% endcapture %}
                {% capture child_class %}dropdown-item d-flex align-items-center text-body {{ child_active }} {% if child.class %}{{ child.class }}{% endif %}{% endcapture %}
                {% capture child_content %}
                  {% if child.icon %}
                    {% uj_icon child.icon, "fa-md me-3" %}
                  {% endif %}
                  <span>{{ child.label }}</span>
                {% endcapture %}

                {% if child.divider %}
                  <li><hr class="dropdown-divider" {{ child_attributes }}/></li>
                {% else %}
                  <li>
                    {% iftruthy child.href %}
                      <a class="{{ child_class }}" href="{{ child.href }}" {{ child_attributes }}>
                        {{ child_content }}
                      </a>
                    {% endiftruthy %}
                    {% iffalsy child.href %}
                      <button class="{{ child_class }}" type="button" {{ child_attributes }}>
                        {{ child_content }}
                      </button>
                    {% endiffalsy %}
                  </li>
                {% endif %}
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <!-- Navigation -->
    <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
      <!-- Centered Navigation Links -->
      <ul class="navbar-nav mx-auto">
        {% for link in data.links %}
          {% if link.dropdown %}
            {% capture link_active %}{% urlmatches link.href, "active" %}{% endcapture %}
            {% capture link_class %}nav-link dropdown-toggle text-body {{ link_active }} {% if link.class %}{{ link.class }}{% endif %}{% endcapture %}
            {% capture link_attributes %}{% if link.attributes %}{% for attr in link.attributes %} {{ attr[0] }}="{{ attr[1] }}"{% endfor %}{% endif %}{% endcapture %}
            <li class="nav-item dropdown">
              <button class="{{ link_class }}" type="button" data-bs-toggle="dropdown" {{ link_attributes }}>
                <span class="d-inline-flex align-items-center">
                  {% if link.icon %}
                    {% uj_icon link.icon, "fa-md me-2" %}
                  {% endif %}
                  <span>{{ link.label }}</span>
                </span>
              </button>
              <ul class="dropdown-menu">
                {% for child in link.dropdown %}
                  {% capture child_active %}{% urlmatches child.href, "active" %}{% endcapture %}
                  {% capture child_class %}dropdown-item text-body {{ child_active }} {% if child.class %}{{ child.class }}{% endif %}{% endcapture %}
                  {% capture child_attributes %}{% if child.attributes %}{% for attr in child.attributes %} {{ attr[0] }}="{{ attr[1] }}"{% endfor %}{% endif %}{% endcapture %}
                  {% capture child_content %}
                    <span class="d-inline-flex align-items-center">
                      {% if child.icon %}
                        {% uj_icon child.icon, "fa-md me-2" %}
                      {% endif %}
                      <span>{{ child.label }}</span>
                    </span>
                  {% endcapture %}
                  <li>
                    {% iftruthy child.href %}
                      <a class="{{ child_class }}" href="{{ child.href }}" {{ child_attributes }}>
                        {{ child_content }}
                      </a>
                    {% endiftruthy %}
                    {% iffalsy child.href %}
                      <button class="{{ child_class }}" type="button" {{ child_attributes }}>
                        {{ child_content }}
                      </button>
                    {% endiffalsy %}
                  </li>
                {% endfor %}
              </ul>
            </li>
          {% else %}
            {% capture link_active %}{% urlmatches link.href, "active" %}{% endcapture %}
            {% capture link_class %}nav-link text-body {{ link_active }} {% if link.class %}{{ link.class }}{% endif %}{% endcapture %}
            {% capture link_attributes %}{% if link.attributes %}{% for attr in link.attributes %} {{ attr[0] }}="{{ attr[1] }}"{% endfor %}{% endif %}{% endcapture %}
            {% capture link_content %}
              <span class="d-inline-flex align-items-center">
                {% if link.icon %}
                  {% uj_icon link.icon, "fa-md me-2" %}
                {% endif %}
                <span>{{ link.label }}</span>
              </span>
            {% endcapture %}
            <li class="nav-item">
              {% iftruthy link.href %}
                <a class="{{ link_class }}" href="{{ link.href }}" {{ link_attributes }}>
                  {{ link_content }}
                </a>
              {% endiftruthy %}
              {% iffalsy link.href %}
                <button class="{{ link_class }}" type="button" {{ link_attributes }}>
                  {{ link_content }}
                </button>
              {% endiffalsy %}
            </li>
          {% endif %}
        {% endfor %}
      </ul>

      <!-- Right-aligned Actions (desktop only) -->
      <div class="d-none d-lg-inline-flex align-items-center">
        {% for action in data.actions %}
          {% if action.dropdown %}
            {% if action.type == 'account' %}
              <!-- Account dropdown with profile picture (desktop) -->
              {% capture action_attributes %}{% if action.attributes %}{% for attr in action.attributes %} {{ attr[0] }}="{{ attr[1] }}"{% endfor %}{% endif %}{% endcapture %}
              <div class="dropdown ms-lg-3 animation-slide-up d-inline-flex" data-wm-bind="@show auth.user" hidden>
                <button class="p-0 border-0 bg-transparent" type="button" data-bs-toggle="dropdown" {{ action_attributes }} aria-expanded="false">
                  <span class="d-flex align-items-center">
                    <span class="position-relative d-inline-block">
                      <span class="avatar avatar-md rounded-circle bg-secondary bg-opacity-10 border d-flex align-items-center justify-content-center overflow-hidden d-inline-flex">
                        <img src="{{ site.uj.placeholder.src }}" data-wm-bind="@attr src auth.user.photoURL" alt="{{ site.brand.name }} profile picture"/>
                      </span>
                      <!-- Active status indicator -->
                      <span class="position-absolute bottom-0 end-0 p-1 bg-success border border-2 border-white avatar avatar-2xs rounded-circle mb-2">
                        <span class="visually-hidden">Active status</span>
                      </span>
                    </span>
                  </span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end shadow" style="min-width: 280px;">
                  <!-- User info header (clickable) -->
                  <li>
                    <a href="/account#profile" class="dropdown-item px-3 py-2 text-decoration-none">
                      <div class="d-flex align-items-center">
                        <div class="position-relative me-3">
                          <div class="avatar avatar-md rounded-circle bg-secondary bg-opacity-10 border d-flex align-items-center justify-content-center overflow-hidden">
                            <img src="{{ site.uj.placeholder.src }}" data-wm-bind="@attr src auth.user.photoURL" alt="{{ site.brand.name }} profile picture"/>
                          </div>
                          <!-- Active status indicator -->
                          <span class="position-absolute bottom-0 end-0 p-1 bg-success border border-2 border-white avatar avatar-2xs rounded-circle mb-0">
                            <span class="visually-hidden">Active status</span>
                          </span>
                        </div>
                        <div class="flex-grow-1 overflow-hidden">
                          <div class="fw-semibold text-truncate text-body" data-wm-bind="@text auth.user.displayName">User</div>
                          <div class="small text-muted text-truncate" data-wm-bind="@text auth.user.email">email@example.com</div>
                        </div>
                      </div>
                    </a>
                  </li>
                  <!-- Dropdown items -->
                  {% for child in action.dropdown %}
                    {% capture child_attributes %}{% if child.attributes %}{% for attr in child.attributes %} {{ attr[0] }}="{{ attr[1] }}"{% endfor %}{% endif %}{% endcapture %}
                    {% capture child_active %}{% urlmatches child.href, "active" %}{% endcapture %}
                    {% capture child_class %}dropdown-item d-flex align-items-center text-body {{ child_active }} {% if child.class %}{{ child.class }}{% endif %}{% endcapture %}
                    {% capture child_content %}
                      {% if child.icon %}
                        {% uj_icon child.icon, "fa-md me-3" %}
                      {% endif %}
                      <span>{{ child.label }}</span>
                    {% endcapture %}

                    {% if child.divider %}
                      <li><hr class="dropdown-divider" {{ child_attributes }}/></li>
                    {% else %}
                      <li>
                        {% iftruthy child.href %}
                          <a class="{{ child_class }}" href="{{ child.href }}" {{ child_attributes }}>
                            {{ child_content }}
                          </a>
                        {% endiftruthy %}
                        {% iffalsy child.href %}
                          <button class="{{ child_class }}" type="button" {{ child_attributes }}>
                            {{ child_content }}
                          </button>
                        {% endiffalsy %}
                      </li>
                    {% endif %}
                  {% endfor %}
                </ul>
              </div>
            {% else %}
              <!-- Regular button dropdown -->
              {% capture action_class %}btn btn-{{ action.color }} dropdown-toggle {% if action.class %}{{ action.class }}{% endif %}{% endcapture %}
              {% capture action_attributes %}{% if action.attributes %}{% for attr in action.attributes %} {{ attr[0] }}="{{ attr[1] }}"{% endfor %}{% endif %}{% endcapture %}
              <div class="dropdown ms-lg-3">
                <button class="{{ action_class }}" type="button" data-bs-toggle="dropdown" {{ action_attributes }}>
                  <span class="d-inline-flex align-items-center">
                    {% if action.icon %}
                      {% uj_icon action.icon, "fa-md me-2" %}
                    {% endif %}
                    <span>{{ action.label }}</span>
                  </span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  {% for child in action.dropdown %}
                    {% capture child_active %}{% urlmatches child.href, "active" %}{% endcapture %}
                    {% capture child_class %}dropdown-item text-body {{ child_active }} {% if child.class %}{{ child.class }}{% endif %}{% endcapture %}
                    {% capture child_attributes %}{% if child.attributes %}{% for attr in child.attributes %} {{ attr[0] }}="{{ attr[1] }}"{% endfor %}{% endif %}{% endcapture %}
                    {% capture child_content %}
                      <span class="d-inline-flex align-items-center">
                        {% if child.icon %}
                          {% uj_icon child.icon, "fa-md me-2" %}
                        {% endif %}
                        <span>{{ child.label }}</span>
                      </span>
                    {% endcapture %}
                    <li>
                      {% iftruthy child.href %}
                        <a class="{{ child_class }}" href="{{ child.href }}" {{ child_attributes }}>
                          {{ child_content }}
                        </a>
                      {% endiftruthy %}
                      {% iffalsy child.href %}
                        <button class="{{ child_class }}" type="button" {{ child_attributes }}>
                          {{ child_content }}
                        </button>
                      {% endiffalsy %}
                    </li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}
          {% else %}
            {% capture action_class %}btn btn-{{ action.color }} ms-lg-3 {% if action.class %}{{ action.class }}{% endif %}{% endcapture %}
            {% capture action_attributes %}{% if action.attributes %}{% for attr in action.attributes %} {{ attr[0] }}="{{ attr[1] }}"{% endfor %}{% endif %}{% endcapture %}
            {% capture action_content %}
              <span class="d-inline-flex align-items-center">
                {% if action.icon %}
                  {% uj_icon action.icon, "fa-md me-2" %}
                {% endif %}
                <span>{{ action.label }}</span>
              </span>
            {% endcapture %}
            {% iftruthy action.href %}
              <a class="{{ action_class }}" href="{{ action.href }}" role="button" {{ action_attributes }}>
                {{ action_content }}
              </a>
            {% endiftruthy %}
            {% iffalsy action.href %}
              <button class="{{ action_class }}" type="button" {{ action_attributes }}>
                {{ action_content }}
              </button>
            {% endiffalsy %}
          {% endif %}
        {% endfor %}
      </div>

      <!-- Non-account actions for mobile (inside collapsible) -->
      <div class="d-lg-none">
        {% for action in data.actions %}
          {% if action.type != 'account' %}
            {% if action.dropdown %}
              <!-- Regular button dropdown -->
              {% capture action_class %}btn btn-{{ action.color }} dropdown-toggle w-100 mt-3 {% if action.class %}{{ action.class }}{% endif %}{% endcapture %}
              {% capture action_attributes %}{% if action.attributes %}{% for attr in action.attributes %} {{ attr[0] }}="{{ attr[1] }}"{% endfor %}{% endif %}{% endcapture %}
              <div class="dropdown">
                <button class="{{ action_class }}" type="button" data-bs-toggle="dropdown" {{ action_attributes }}>
                  <span class="d-inline-flex align-items-center">
                    {% if action.icon %}
                      {% uj_icon action.icon, "fa-md me-2" %}
                    {% endif %}
                    <span>{{ action.label }}</span>
                  </span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end w-100">
                  {% for child in action.dropdown %}
                    {% capture child_active %}{% urlmatches child.href, "active" %}{% endcapture %}
                    {% capture child_class %}dropdown-item text-body {{ child_active }} {% if child.class %}{{ child.class }}{% endif %}{% endcapture %}
                    {% capture child_attributes %}{% if child.attributes %}{% for attr in child.attributes %} {{ attr[0] }}="{{ attr[1] }}"{% endfor %}{% endif %}{% endcapture %}
                    {% capture child_content %}
                      <span class="d-inline-flex align-items-center">
                        {% if child.icon %}
                          {% uj_icon child.icon, "fa-md me-2" %}
                        {% endif %}
                        <span>{{ child.label }}</span>
                      </span>
                    {% endcapture %}
                    <li>
                      {% iftruthy child.href %}
                        <a class="{{ child_class }}" href="{{ child.href }}" {{ child_attributes }}>
                          {{ child_content }}
                        </a>
                      {% endiftruthy %}
                      {% iffalsy child.href %}
                        <button class="{{ child_class }}" type="button" {{ child_attributes }}>
                          {{ child_content }}
                        </button>
                      {% endiffalsy %}
                    </li>
                  {% endfor %}
                </ul>
              </div>
            {% else %}
              {% capture action_class %}btn btn-{{ action.color }} w-100 mt-3 {% if action.class %}{{ action.class }}{% endif %}{% endcapture %}
              {% capture action_attributes %}{% if action.attributes %}{% for attr in action.attributes %} {{ attr[0] }}="{{ attr[1] }}"{% endfor %}{% endif %}{% endcapture %}
              {% capture action_content %}
                <span class="d-inline-flex align-items-center">
                  {% if action.icon %}
                    {% uj_icon action.icon, "fa-md me-2" %}
                  {% endif %}
                  <span>{{ action.label }}</span>
                </span>
              {% endcapture %}
              {% iftruthy action.href %}
                <a class="{{ action_class }}" href="{{ action.href }}" role="button" {{ action_attributes }}>
                  {{ action_content }}
                </a>
              {% endiftruthy %}
              {% iffalsy action.href %}
                <button class="{{ action_class }}" type="button" {{ action_attributes }}>
                  {{ action_content }}
                </button>
              {% endiffalsy %}
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </nav>
</div>
