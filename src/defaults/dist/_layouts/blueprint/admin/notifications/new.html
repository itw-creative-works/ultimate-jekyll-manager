---
### ALL PAGES ###
layout: themes/classy/admin/core/iframe

### REGULAR PAGES ###
meta:
  title: "Create Notification - Admin"
  description: "Create and send a new notification"
  breadcrumb: "Create Notification"
---

<!-- Success/Error Alerts -->
<div class="notification-success-alert alert alert-success d-none" role="alert">
  <i class="bi bi-check-circle"></i> <span class="alert-message">Notification sent successfully!</span>
</div>

<div class="notification-error-alert alert alert-danger d-none" role="alert">
  <i class="bi bi-exclamation-triangle"></i> <span class="alert-message">An error occurred</span>
</div>

<!-- Notification Creation Form -->
<div class="row">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-body">
        <form id="notification-form" novalidate>
          <!-- Notification Content -->
          <h5 class="mb-3">
            Notification Content
          </h5>

          <div class="mb-3">
            <label for="notification-icon" class="form-label">
              Icon URL <span class="text-danger">*</span>
            </label>
            <input type="url"
                   class="form-control"
                   id="notification-icon"
                   name="notification.icon"
                   placeholder="https://example.com/icon.png"
                   value="{{ site.meta.image }}"
                   pattern="https?://.+"
                   title="URL must start with http:// or https://"
                   required>
            <div class="invalid-feedback">Please provide a valid icon URL</div>
          </div>

          <div class="mb-3">
            <label for="notification-title" class="form-label">
              Title <span class="text-danger">*</span>
            </label>
            <input type="text"
                   class="form-control"
                   id="notification-title"
                   name="notification.title"
                   placeholder="Enter notification title"
                   minlength="3"
                   maxlength="60"
                   required>
            <small class="text-muted">
              <span id="title-char-count">0 / 60</span> characters
            </small>
            <div class="invalid-feedback">Title is required (3-60 characters)</div>
          </div>

          <div class="mb-3">
            <label for="notification-body" class="form-label">
              Body <span class="text-danger">*</span>
            </label>
            <textarea class="form-control"
                      id="notification-body"
                      name="notification.body"
                      rows="3"
                      placeholder="Enter notification message"
                      minlength="10"
                      maxlength="200"
                      required></textarea>
            <small class="text-muted">
              <span id="body-char-count">0 / 200</span> characters
            </small>
            <div class="invalid-feedback">Body is required (10-200 characters)</div>
          </div>

          <div class="mb-3">
            <label for="notification-url" class="form-label">
              Click Action URL <span class="text-danger">*</span>
            </label>
            <input type="url"
                   class="form-control"
                   id="notification-url"
                   name="notification.clickAction"
                   placeholder="https://example.com/landing"
                   value="{{ site.url }}"
                   pattern="https?://.+"
                   title="URL must start with http:// or https://"
                   required>
            <small class="text-muted">Where users go when clicking the notification</small>
            <div class="invalid-feedback">Please provide a valid URL</div>
          </div>

          {% comment %}
          <!-- Delivery Channels - NOT CURRENTLY SUPPORTED BY BACKEND -->
          <h5 class="mb-3 mt-4">
            {% uj_icon "send", "fa-md me-2 text-info" %}
            Delivery Channels
          </h5>

          <div class="row">
            <div class="col-6 col-md-3 mb-3">
              <div class="form-check">
                <input class="form-check-input"
                       type="checkbox"
                       id="channel-push"
                       name="channels.push.enabled"
                       checked>
                <label class="form-check-label" for="channel-push">
                  {% uj_icon "mobile", "fa-sm me-1 text-primary" %}
                  Push
                </label>
              </div>
            </div>
            <div class="col-6 col-md-3 mb-3">
              <div class="form-check">
                <input class="form-check-input"
                       type="checkbox"
                       id="channel-email"
                       name="channels.email.enabled">
                <label class="form-check-label" for="channel-email">
                  {% uj_icon "envelope", "fa-sm me-1 text-info" %}
                  Email
                </label>
              </div>
            </div>
            <div class="col-6 col-md-3 mb-3">
              <div class="form-check">
                <input class="form-check-input"
                       type="checkbox"
                       id="channel-sms"
                       name="channels.sms.enabled">
                <label class="form-check-label" for="channel-sms">
                  {% uj_icon "comment-sms", "fa-sm me-1 text-success" %}
                  SMS
                </label>
              </div>
            </div>
            <div class="col-6 col-md-3 mb-3">
              <div class="form-check">
                <input class="form-check-input"
                       type="checkbox"
                       id="channel-inapp"
                       name="channels.inapp.enabled">
                <label class="form-check-label" for="channel-inapp">
                  {% uj_icon "bell", "fa-sm me-1 text-warning" %}
                  In-App
                </label>
              </div>
            </div>
          </div>

          <!-- Channel-specific settings (hidden by default) -->
          <div id="push-channel-settings" class="channel-settings">
            <!-- Push-specific options can go here -->
          </div>

          <div id="email-channel-settings" class="channel-settings d-none">
            <div class="mb-3">
              <label class="form-label">Email Subject</label>
              <input type="text" class="form-control" name="channels.email.subject">
            </div>
          </div>
          {% endcomment %}

          {% comment %}
          <!-- Target Audience - NOT CURRENTLY SUPPORTED BY BACKEND -->
          <h5 class="mb-3 mt-4">
            {% uj_icon "people", "fa-md me-2 text-success" %}
            Target Audience
          </h5>

          <div class="mb-3">
            <div class="form-check">
              <input class="form-check-input"
                     type="radio"
                     name="audience.type"
                     id="audience-all"
                     value="all"
                     checked>
              <label class="form-check-label" for="audience-all">
                All Users
              </label>
            </div>
            <div class="form-check mt-2">
              <input class="form-check-input"
                     type="radio"
                     name="audience.type"
                     id="audience-segment"
                     value="segment">
              <label class="form-check-label" for="audience-segment">
                User Segment
              </label>
            </div>
            <div class="form-check mt-2">
              <input class="form-check-input"
                     type="radio"
                     name="audience.type"
                     id="audience-test"
                     value="test">
              <label class="form-check-label" for="audience-test">
                Test Users Only
              </label>
            </div>
          </div>
          {% endcomment %}

          <!-- Schedule -->
          <h5 class="mb-3 mt-4">
            Schedule
          </h5>

          <div class="mb-3">
            <label class="form-label">Auto-submit Date & Time</label>
            <small class="d-block text-muted mb-2">
              Leave empty to send immediately, or schedule for later
            </small>
            <div class="row">
              <div class="col-md-5">
                <input type="date"
                       class="form-control"
                       name="schedule.date"
                       id="schedule-date">
              </div>
              <div class="col-md-4">
                <input type="time"
                       class="form-control"
                       name="schedule.time"
                       id="schedule-time">
              </div>
              <div class="col-md-3">
                <button type="button"
                        class="btn btn-sm btn-outline-primary w-100 btn-set-auto-submit">
                  Tomorrow 10am
                </button>
              </div>
            </div>
            <div class="mt-2">
              <button type="button"
                      class="btn btn-sm btn-outline-adaptive btn-clear-auto-submit">
                Clear Schedule
              </button>
              <span id="auto-submit-countdown" class="ms-2 text-primary d-none"></span>
            </div>
          </div>

          <!-- Warning Message -->
          <div class="alert alert-warning mt-4" role="alert">
            <h6 class="alert-heading">
              {% uj_icon "exclamation-triangle", "fa-sm me-1" %}
              Sending to Notification Network
            </h6>
            <p class="mb-0">
              You are about to send this notification to
              <strong class="notification-user-count">0 / 0</strong> users.
              Please review carefully before submitting.
            </p>
          </div>

          <!-- Submit Button -->
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary btn-lg">
              <span class="spinner-border spinner-border-sm d-none" role="status"></span>
              {% uj_icon "paper-plane", "fa-md me-2" %}
              Send Notification
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Preview Panel -->
  <div class="col-lg-4">
    <div class="card sticky-top mt-3 mt-lg-0">
      <div class="card-header bg-primary text-white">
        <h6 class="mb-0">
          Live Preview
        </h6>
      </div>
      <div class="card-body">
        <!-- Mobile Device Frame -->
        <div class="mobile-preview-frame border rounded p-2 bg-dark">
          <div class="mobile-screen rounded p-2">
            <!-- Status Bar -->
            <div class="status-bar d-flex justify-content-between small text-light text-opacity-50 mb-2">
              <span>9:41 AM</span>
              <span>
                {% uj_icon "wifi", "fa-sm me-1" %}
                {% uj_icon "battery-full", "fa-sm" %}
              </span>
            </div>

            <!-- Notification Preview (clickable) -->
            <div class="notification-preview bg-body-secondary rounded p-3 shadow-sm"
                 id="notification-preview-clickable"
                 role="button"
                 style="cursor: pointer;"
                 title="Click to test the notification link">
              <div class="d-flex align-items-start">
                <img src="{{ site.uj.placeholder.src }}"
                     class="rounded me-2"
                     id="preview-icon"
                     width="50"
                     height="50">
                <div class="flex-fill">
                  <div class="fw-semibold small" id="preview-title">
                    Notification Title
                  </div>
                  <div class="small text-muted mt-1" id="preview-body">
                    This is what your notification body will look like...
                  </div>
                  <div class="small text-muted mt-1">
                    {% uj_icon "clock", "fa-xs me-1" %}
                    <span id="preview-time">Now</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Other notifications -->
            <div class="mt-2 opacity-50">
              <div class="bg-body-secondary rounded p-2 small">
                <div class="text-muted">Earlier notifications...</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Stats -->
        <div class="mt-4">
          <h6 class="text-muted small mb-3">ESTIMATED REACH</h6>

          <div class="mb-2">
            <div class="d-flex justify-content-between align-items-center">
              <span>
                {% uj_icon "people", "fa-sm me-1" %}
                Target Users
              </span>
              <span class="badge bg-primary notification-user-count">0 / 0</span>
            </div>
          </div>

          <div class="progress" style="height: 4px;">
            <div class="progress-bar bg-primary" role="progressbar" style="width: 100%"></div>
          </div>

          <small class="text-muted d-block mt-2">
            Final count may vary based on user preferences and device availability
          </small>
        </div>

        {% comment %}
        <!-- Channel Status - NOT CURRENTLY SUPPORTED -->
        <div class="mt-4">
          <h6 class="text-muted small mb-2">ACTIVE CHANNELS</h6>
          <div class="d-flex gap-2 flex-wrap">
            <span class="badge bg-primary">
              {% uj_icon "mobile", "fa-xs me-1" %}
              Push
            </span>
            <!-- Additional channel badges will be shown dynamically -->
          </div>
        </div>
        {% endcomment %}
      </div>
    </div>
  </div>
</div>
